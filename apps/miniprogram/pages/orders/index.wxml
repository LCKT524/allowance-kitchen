<view class="page-wrap">
  <view class="header">{{tab==='available'?'外送接单':'我的订单'}}</view>
  <view wx:if="{{tab!=='available'}}" class="card filter-status">
    <button class="btn" bindtap="setStatus" data-v="all">全部</button>
    <button class="btn" bindtap="setStatus" data-v="pending">待接单</button>
    <button class="btn" bindtap="setStatus" data-v="accepted">已接单</button>
    <button class="btn" bindtap="setStatus" data-v="in_progress">进行中</button>
    <button class="btn" bindtap="setStatus" data-v="completed">已完成</button>
  </view>
  <view wx:if="{{loading}}" class="card">加载中...</view>
  <view wx:elif="{{error}}" class="error">{{error}}</view>
  <view wx:else class="list">
    <view wx:for="{{items}}" wx:key="id" class="card">
      <view class="list-item">
        <view class="title">{{item._names}}</view>
        <view class="badge {{item._statusClass}}">{{item._statusText}}</view>
      </view>
      <view class="sub">
        <view>总价：￥{{item.total_price}}</view>
        <view>下单：{{item._created_at}}</view>
      </view>
      <view class="actions">
        <navigator url="/pages/order-detail/index?id={{item.id}}" class="btn btn-secondary">查看</navigator>
        <navigator url="/pages/chat/index?orderId={{item.id}}" class="btn btn-secondary">聊天</navigator>
        <button wx:if="{{tab==='available'}}" bindtap="accept" data-id="{{item.id}}" class="btn btn-primary">接单</button>
        <block wx:if="{{tab==='mine'}}">
          <button wx:if="{{item.status==='accepted'}}" bindtap="start" data-id="{{item.id}}" class="btn btn-primary">开始制作</button>
          <button wx:if="{{item.status==='accepted'}}" bindtap="cancel" data-id="{{item.id}}" class="btn btn-secondary">取消接单</button>
          <button wx:if="{{item.status==='in_progress'}}" bindtap="complete" data-id="{{item.id}}" class="btn btn-primary">完成订单</button>
        </block>
      </view>
    </view>
  </view>
</view>